<!DOCTYPE html>
<html>
<head>
  <script src="../assets/js/color-modes.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" 
integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<title>ICS Species/Accession</title>
<link rel="shortcut icon" href="a198cd0c_e2f0_4c99_ba51_342624a24db9_WP4_icon.ico" type="image/x-icon"/>
<link href = "https://fonts.googleapis.com/css?family=Nunito+Sans:400,900&display=swap" rel="stylesheet">
<style>
* {
  box-sizing: border-box;
}
body,#icsinput{text-align: center;}
#icsInput {
  background-image: 
url('https://upload.wikimedia.org/wikipedia/commons/thumb/7/7e/Vector_search_icon.svg/221px-Vector_search_icon.svg.png');
  background-position: 10px 10px;;
  background-repeat: no-repeat;
  background-size: 25px;
  width: 60%;
  font-size: 16px;
  padding: 12px 20px 12px 40px;
  border: 1px solid #ddd;
  margin-bottom: 12px;
  border-radius: 25px;
}
#icsInput:focus {
  outline:none
}
#icsTable {
  border-collapse: collapse;
  width: 85%;
  border: 1px solid #ddd;
  font-size: 18px;
  margin-bottom:40px;
  margin-left: auto;
  margin-right: auto;
}
#icsTable th, #artTable td {
  text-align: left;
  padding: 12px;
  text-align: center;

}
#icsTable tr {
  border-bottom: 1px solid #ddd;

}
#icsTable tr.header, #artTable tr:hover {
  background-color: #f1f1f1;

}

a {
  color: #295135;
}

h2, h1, p {
  font-family: 'Nunito Sans', sans-serif;
}
h1:hover {
  animation-name: artshadow;
  animation-timing-function: ease-in-out;
  animation-fill-mode: both;
  animation-duration: 0.5s;
  animation-delay: 0.1s;
}

.nav-link_custom {
  font-size: 2.0em;
}
.no-bold {
  font-weight: normal;
  font-size: 0.8em;
  color: #ffffff;
}
.nav-link_header {
  color: #ffffff;
  /* font-weight: bold; */
}
.nav-bar_color {
  --bs-navbar-color: #262c7c;
}
.currentPath_color {
  color: #ffffff;
}
.otherPage_color{
  color: #cbcbcb;
}

@keyframes artshadow {
  from {}
  to {text-shadow: 2px 2px 5px black;}
}
#header a{
  color: #173b71;
  transition: 0.3s;
}
#subheader{
  color: #406E8E;

}
.button {
  display: inline-block;
  padding: 15px 25px;
  font-size: 18px;
  cursor: pointer;
  text-align: center;
  text-decoration: none;
  outline: none;
  color: #fff;
  background-color: #406E8E;
  border: none;
  border-radius: 15px;
  box-shadow: 0 9px #999;
  margin-bottom: 20px
}

.button:hover {background-color: #23395B}

.button:active {
  background-color: #23395B;
  box-shadow: 0 5px #666;
  transform: translateY(4px);
}

.centerfr {
  text-align: center;
}

/* .button1:hover {
  box-shadow: 0 12px 16px 0 rgba(0,0,0,0.24),0 17px 50px 0 rgba(0,0,0,0.19);
} */
</style>
<i class="bi bi-house-fill"></i>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
  rel="stylesheet"
/>
<link
  href="https://getbootstrap.com/docs/5.3/assets/css/docs.css"
  rel="stylesheet"
/>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
</head>
<!-- Google tag (gtag.js) -->

<script async src="https://www.googletagmanager.com/gtag/js?id=G-6NSJQRS3EW"></script>

<script>

  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-6NSJQRS3EW');

</script>
<body>
  <nav class="navbar navbar-expand-lg bg-primary" data-bs-theme="dark">
    <div class="container-fluid nav-link_custom nav-link_header">
      <a class="nav-link" href="index.html"> 
        <img src="./Images/house-fill.svg" alt="Logo" width="50" height="40" class="d-inline-block align-text-top">
      </a>
      <button
        class="navbar-toggler"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item no-bold otherPage_color">
            <a class="nav-link" aria-current="page" href="species_accession.html">Species Search</a>
          </li>
          <li class="nav-item no-bold currentPath_color">
            <a class="nav-link active" href="gcf_search.html">GCF Search</a>
          </li>
          <li class="nav-item no-bold otherPage_color">
            <a class="nav-link" aria-current="page" href="taxa_search.html">Taxa Search</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

          <!-- Button trigger modal -->
<button type="button" class="btn btn-lg btn-primary allButton" data-bs-toggle="modal" data-bs-target="#exampleModal" style="margin:10px">
  What are * GCFs?
</button>
<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>GCFs with the * indicate GCFs that were specifically analyzed in 
          the publication. These GCF pages contain download links for the 
          reference BGCs used in the study. These reference predictions were 
          hand checked and contain all highly conserved GCF genes.</p>
      </div>
    </div>
  </div>
</div>

<h1 id="header" class="centerfr"><a href="index.html"><b>Gene Cluster Families (GCFs)</b></a></h1>
<h2 id="subheader" class="centerfr">Search by GCF</h2>
<div class="centerenter centerfr">
<input type="text" id="icsInput" onkeyup="icsFunction()" placeholder="GCF" title="GCF search">
</div>
<div class="centerfr"><button class="button button1 ceneterfr" onclick="downloadTsv()">Download the displayed results (tsv)</button></div>

<!-- <div><button onclick="downloadTsv()">Download filtered results as tsv</button></div> -->
<script>
  const downloadTsv = () => {
    // convert current visible data to tsv
    var currentVisibleTsv =  "GCF\tSpecies\tGenera\tFamilies\tOrders\tClasses\tPhyla\n";
    for (var i = 0; i < currentVisibleData.length; i ++) {
      currentVisibleTsv = currentVisibleTsv.concat(currentVisibleData[i].GCF);
      currentVisibleTsv = currentVisibleTsv.concat("\t", currentVisibleData[i].Species);
      currentVisibleTsv = currentVisibleTsv.concat("\t", currentVisibleData[i].Genera);
      currentVisibleTsv = currentVisibleTsv.concat("\t", currentVisibleData[i].Families);
      currentVisibleTsv = currentVisibleTsv.concat("\t", currentVisibleData[i].Orders);
      currentVisibleTsv = currentVisibleTsv.concat("\t", currentVisibleData[i].Classes);
      currentVisibleTsv = currentVisibleTsv.concat("\t", currentVisibleData[i].Phyla);
      currentVisibleTsv = currentVisibleTsv.concat("\n");
    }

    const link = document.createElement("a");
    const file = new Blob([currentVisibleTsv], { type: 'text/tsv' });
    link.href = URL.createObjectURL(file);
    link.download = "GCFs_filtered.tsv";
    link.click();
    URL.revokeObjectURL(link.href);
  };
</script>
<div class="tablesearch">
<script>

var currentVisibleData;

fetch("Data/GCF_Table.json").then(function (response) {
    return response.json();
}).then(function (data) {
  data.sort(function (a, b) {
    let aSpecies = parseInt(a.Species);
    let bSpecies = parseInt(b.Species);
    if (aSpecies > bSpecies) {
      return -1;
    }
    if (aSpecies < bSpecies) {
      return 1;
    }
    return 0;
  });

  currentVisibleData  = data;

  appendData(data);
}).catch(function (err) {
  console.log('error ' + err);
});


function appendData(data) {
    var mainContainer = document.getElementById("icsTable");

    for (var i = 0; i < data.length; i ++) {
        var div = document.createElement("tr");
        div.setAttribute("class", "centerfr");
        let gcf = data[i].GCF;
        
        div.innerHTML = '<td><a href=gcfs.html?gcf=' + encodeURIComponent(gcf) + '>' + gcf + '</a></td>'
            + '<td>' + data[i].Species + '</td>'
            + '<td>' + data[i].Genera + '</td>'
            + '<td>' + data[i].Families + '</td>'
            + '<td>' + data[i].Orders + '</td>'
            + '<td>' + data[i].Classes + '</td>'
            + '<td>' + data[i].Phyla + '</td>';
        mainContainer.appendChild(div);
    }
}

</script>
<table id="icsTable">
    <tr class="header">
        <th style="width:14%">GCF</th>
        <th style="width:14%">Species</th>
        <th style="width:14%">Genera</th>
        <th style="width:14%">Families</th>
        <th style="width:14%">Orders</th>
        <th style="width:14%">Classes</th>
        <th style="width:14%">Phyla</th>
    </tr>
</table>
<script>function icsFunction() {
  // Clear currentVisibleData
  currentVisibleData = [];

  // Declare starting variables
  var input = document.getElementById("icsInput");
  var filter = input.value.toUpperCase();
  var table = document.getElementById("icsTable");
  var trs = table.getElementsByTagName("tr");
  // Loop through rows
  for (var i = 1; i < trs.length; i++) {
    // Define the cells
    var tds = trs[i].getElementsByTagName("td");
    // show the row
    trs[i].style.display = "";
    // loop through row cells
    var match = tds[0].innerHTML.toUpperCase().indexOf(filter) > -1;
    // if there's no match hide the row
    if (!match && i > 0) {
      trs[i].style.display = "none";
    } else {
      // if there is a match make sure it's stored in currentVisibleData
      currentVisibleData.push({
        "GCF": tds[0].innerText, 
        "Species": tds[1].innerText,
        "Genera": tds[2].innerText,
        "Families": tds[3].innerText,
        "Orders": tds[4].innerText,
        "Classes": tds[5].innerText,
        "Phyla": tds[6].innerText,
      });
    }
  }
}
</script>
</body>
</html>
